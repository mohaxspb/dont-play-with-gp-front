<div>

  <div id="articles-container"
       class="position-relative min-full-screen-height"
       infiniteScroll
       [infiniteScrollDistance]="2"
       [infiniteScrollThrottle]="300"
       [infiniteScrollDisabled]="(bottomProgressInAction | async)
       || (bottomProgressErrorOccurred | async)
       || articlesListEndReached()"
       (scrolled)="onScroll()"
  >
    <div *ngIf="articles.length!=0">
      <div *ngFor="let article of articles"
           class="default-margin-bottom"
           [ngClass.gt-xs]=""
           [ngClass]="['default-margin-left', 'default-margin-right']">
        <mat-card *ngVar="article.translations[indexOfCorrectArticleTranslation(article)] as translation">

          <div id="header-container" fxLayout.gt-xs="row" fxLayout="column" fxLayoutAlign="start start">

            <mat-card-header
              (click)="onArticleClicked(article, translation)"
              fxFlex
              fxFlexOrder="2"
              fxFlex.gt-xs
              fxFlexOrder.gt-xs="1"
            >
              <mat-card-title>{{translation.title}}</mat-card-title>
              <mat-card-subtitle>
                <span>{{article.publishedDate | date:'medium':'UTC': preferredLanguage.langCode}}</span>
              </mat-card-subtitle>
              <mat-card-subtitle
                *ngIf="article.sourceAuthorName != null || (article.author.fullName!=null && article.author.fullName.length>0)"
              >Author: {{article.sourceAuthorName != null ? article.sourceAuthorName : article.author.fullName}}</mat-card-subtitle>
            </mat-card-header>

            <img
                 src="{{translation.imageUrl}}"
                 alt="Article image"
                 fxShow="{{translation.imageUrl!=null}}"
                 fxFlexOrder="1"
                 fxFlexOrder.gt-xs="2"
                 (click)="onArticleClicked(article, translation)"
                 [ngClass]="{'article-image':true, 'default-margin-bottom':true, 'article-image-desktop':false}"
                 [ngClass.gt-xs]="{'article-image':false, 'article-image-desktop':true}"
                 onerror="if (this.src !== 'assets/baseline-image-24px.svg') this.src = 'assets/baseline-image-24px.svg';"
            >
          </div>

          <mat-card-content
            class="default-margin-left"
            (click)="onArticleClicked(article, translation)"
          >{{translation.shortDescription}}</mat-card-content>
          <mat-card-actions>
            <mat-button-toggle-group
              class="default-margin-bottom default-margin-left"
              [value]="correctArticleLanguage(article)"
              (change)="translation = getTranslationForLanguageFromArticle($event.value, article)">
              <mat-button-toggle
                *ngFor="let lang of getAvailableArticleLanguages(article)"
                [value]="lang"
              >{{lang.langCode.toUpperCase()}}</mat-button-toggle>
            </mat-button-toggle-group>
          </mat-card-actions>
        </mat-card>

      </div>
    </div>

    <div id="data-loading-indication" *ngIf="progressInAction|async"
         class="background-half-transparent-white cover"
         (click)="$event.stopPropagation()"
    >
      <mat-spinner
        class="center-inside-both-axis"
        [diameter]="24"
      ></mat-spinner>
    </div>

    <div id="bottom-loading-indication" fxLayout fxLayoutAlign="center center">
      <mat-spinner
        *ngIf="bottomProgressInAction|async"
        class="center-inside-both-axis"
        [diameter]="24"
      ></mat-spinner>

      <button
        *ngIf="(bottomProgressErrorOccurred|async) && !(bottomProgressInAction|async)"
        mat-flat-button
        (click)="loadArticles(articles.length)"
      >Try again</button>

      <div *ngIf="articlesListEndReached()">
        <p>This is the end of articles list</p>
      </div>
    </div>
  </div>

</div>
<div>

  <button
    mat-fab
    color="accent"
    aria-label="Create article"
    matTooltip="Create article"
    class="bottom-right-corner"
    (click)="onCreateArticleClicked()"
  >
    <mat-icon>edit</mat-icon>
  </button>
</div>
