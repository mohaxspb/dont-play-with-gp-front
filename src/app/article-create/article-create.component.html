<div>

  <mat-card>
    <mat-card-header>
      <mat-icon mat-card-avatar color="accent">edit</mat-icon>
      <mat-card-title>New article creation</mat-card-title>
    </mat-card-header>
    <mat-card-content>

      <div id="data-loading-indication">

        <mat-spinner
          *ngIf="dataIsLoading | async"
          class="center-inside"
          [diameter]="24"
        ></mat-spinner>

        <button
          *ngIf="user == null && !(dataIsLoading | async)"
          class="default-margin-left"
          mat-raised-button
          color="warn"
          type="button"
          (click)="onDataRefreshClicked()"
        >Refresh</button>

      </div>

      <div *ngIf="user!=null && languagesListFromApi!=null" id="articleFormContainer">

        <form
          [formGroup]="articleCreateFormGroup"
          name="accountEditForm"
          (ngSubmit)="onArticleCreateClicked()"
        >

          <mat-card>
            <mat-card-header>
              <div class="mat-input-element">
                <mat-checkbox
                  formControlName="articleIsFromAnotherSite"
                  name="articleIsFromAnotherSite"
                  color="primary"
                  (change)="onArticleIsFromAnotherSiteClicked($event.checked)"
                >Article is from another site</mat-checkbox>
              </div>
            </mat-card-header>
            <mat-card-content *ngIf="articleIsFromAnotherSite">

              <div id="input-source-title" class="mat-input-element">
                <mat-form-field class="full-width-field">
                  <label>
                    <input
                      matInput
                      formControlName="sourceTitle"
                      placeholder="Source title"
                      name="sourceTitle"
                      required="{{articleIsFromAnotherSite}}"
                      (change)="onSourceTitleChanged($event.target.value)"
                    >
                  </label>
                  <mat-error
                    *ngIf="articleCreateFormGroup.controls.sourceTitle.errors?.required">You must provide title</mat-error>
                </mat-form-field>
              </div>
              <div id="input-source-author" class="mat-input-element">
                <mat-form-field class="full-width-field">
                  <label>
                    <input
                      matInput
                      formControlName="sourceAuthorName"
                      placeholder="Source author name"
                      name="sourceAuthorName"
                      (change)="onSourceAuthorNameChanged($event.target.value)"
                    >
                  </label>
                </mat-form-field>
              </div>
              <div id="input-source-url" class="mat-input-element">
                <mat-form-field class="full-width-field">
                  <label>
                    <input
                      matInput
                      formControlName="sourceUrl"
                      placeholder="Source url"
                      name="sourceUrl"
                      required="{{articleIsFromAnotherSite}}"
                      (change)="onSourceUrlChanged($event.target.value)"
                    >
                  </label>
                  <mat-error
                    *ngIf="articleCreateFormGroup.controls.sourceUrl.errors?.required">You must provide url</mat-error>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>

          <div>
            <mat-form-field class="full-width-field default-margin-top">
              <mat-label>Primary language</mat-label>

              <mat-select
                formControlName="primaryLanguageSelect"
                [errorStateMatcher]="matcher"
                required
                (selectionChange)="onPrimaryLanguageChanged($event.value)"
              >
                <mat-option
                  *ngFor="let language of languagesListFromApi"
                  [value]="language">{{language.langCode.toUpperCase()}}
                </mat-option>
              </mat-select>

              <mat-error *ngIf="articleCreateFormGroup.controls.primaryLanguageSelect.errors?.required"
              >You must make a selection</mat-error>

            </mat-form-field>

          </div>

          <div id="input-title" class="mat-input-element">
            <mat-form-field class="full-width-field">
              <label>
                <input
                  matInput
                  formControlName="title"
                  placeholder="Title"
                  name="title"
                  required
                  (change)="onTitleChanged($event.target.value)"
                >
              </label>
              <mat-error
                *ngIf="articleCreateFormGroup.controls.title.errors?.required">You must provide title</mat-error>
            </mat-form-field>
          </div>

          <div id="input-shortDescription" class="mat-input-element">
            <mat-form-field class="full-width-field">
              <label>
                <textarea
                  matInput
                  formControlName="shortDescription"
                  placeholder="Short description"
                  name="shortDescription"
                  (change)="onShortDescriptionChanged($event.target.value)"
                  rows="4"
                ></textarea>
              </label>
            </mat-form-field>
          </div>

          <div id="article-text-translations">
            <div class="full-width-field default-margin-bottom">
              <label>Article text</label>
              <!--suppress AngularUndefinedBinding -->
              <angular-markdown-editor
                textareaId="editor1"
                rows="12"
                formControlName="markdownText"
                (onChange)="onTextChanged($event.target.value)"
              >
              </angular-markdown-editor>
            </div>

            <div id="textPreview" class="default-margin-bottom">
              <label>Preview</label>
              <mat-card>
                <mat-card-content>
                  <markdown [data]="text"></markdown>
                </mat-card-content>
              </mat-card>
            </div>
          </div>


          <p>
            <button
              mat-raised-button
              color="accent"
              type="submit"
              [disabled]="!articleCreateFormGroup.valid"
            >Save</button>
          </p>

        </form>

      </div>
    </mat-card-content>
  </mat-card>


</div>
